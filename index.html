<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roleta Analyst • Painel</title>

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">RA</div>
        <div class="title">Roleta Analyst</div>
      </div>

      <nav>
        <button class="nav-btn active" data-panel="dashboard">Dashboard</button>
        <button class="nav-btn" data-panel="analysis">Análises AI</button>
        <button class="nav-btn" data-panel="bets">Jogadas</button>
        <button class="nav-btn" data-panel="logs">Logs</button>
        <button class="nav-btn" data-panel="settings">Config</button>
      </nav>

      <div class="sidebar-footer">
        <div id="bot-indicator" class="indicator running">RUNNING</div>
        <div class="small">API: <span id="api-base">/</span></div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <!-- TOPBAR / LOGIN -->
      <header class="topbar">
        <div class="left">
          <h1>Painel • Roleta Analyst</h1>
        </div>
        <div class="right">
          <div id="login-block" class="login-block">
            <input id="login-user" placeholder="Usuário" />
            <input id="login-pass" placeholder="Senha" type="password" />
            <button id="login-btn" class="btn primary" onclick="login()">Entrar</button>
          </div>
          <div id="user-info" class="user-info" style="display:none;">
            <span id="username-label">admin</span>
            <button class="btn ghost" onclick="logout()">Sair</button>
          </div>
        </div>
      </header>

      <!-- PANELS -->
      <section id="panel-dashboard" class="panel active">
        <div class="cards">
          <div class="card">
            <div class="card-title">Saldo Simulado</div>
            <div class="card-value" id="saldo">R$ 0,00</div>
          </div>
          <div class="card">
            <div class="card-title">P / L</div>
            <div class="card-value" id="pl">R$ 0,00</div>
          </div>
          <div class="card">
            <div class="card-title">ROI</div>
            <div class="card-value" id="roi">0%</div>
          </div>
          <div class="card">
            <div class="card-title">Status Bot</div>
            <div class="card-value">
              <button id="bot-toggle" class="btn status running" onclick="toggleBot()">⏸ Pausar</button>
            </div>
          </div>
        </div>

        <div class="layout-two">
          <div class="panel-left">
            <div class="card chart-card">
              <div class="card-header"><strong>Performance Acumulada</strong></div>
              <div id="chart" style="height:320px;"></div>
            </div>

            <div class="card">
              <div class="card-header"><strong>Última Análise (AI)</strong>
                <button class="btn small" onclick="carregarAnalise()">Atualizar</button>
              </div>
              <pre id="analysis-box" class="analysis-box">Nenhuma análise carregada.</pre>
            </div>
          </div>

          <div class="panel-right">
            <div class="card">
              <div class="card-header"><strong>Criar Jogada Manual</strong></div>
              <div class="form-row">
                <input id="manual-numbers" placeholder="Ex: 2,8,17,20,26,35" />
                <input id="manual-stake" placeholder="Stake (ex: 3.5)" />
                <button class="btn" onclick="criarJogada()">Criar Jogada</button>
              </div>
              <div class="hint">Jogadas manuais são locais se endpoint não persistir.</div>
            </div>

            <div class="card small-card">
              <div class="card-header"><strong>Top Confluence</strong>
                <button class="btn small" onclick="carregarConfluence()">Atualizar</button>
              </div>
              <div id="confluence" class="mini-list">Carregando...</div>
            </div>

            <div class="card small-card">
              <div class="card-header"><strong>Configurações Rápidas</strong></div>
              <div class="form-col">
                <label>Min Edge<input id="cfg-minedge" type="number" step="0.001" /></label>
                <label>Kelly Fraction<input id="cfg-kelly" type="number" step="0.1" /></label>
                <label>Chip Value<input id="cfg-chip" type="number" step="0.1" /></label>
                <button class="btn" onclick="salvarConfigs()">Salvar</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="panel-analysis" class="panel">
        <div class="card full">
          <div class="card-header"><strong>Z-Scores & Momentum</strong></div>
          <div id="zscore-area" class="analysis-grid">Carregando...</div>
        </div>
      </section>

      <section id="panel-bets" class="panel">
        <div class="card full">
          <div class="card-header"><strong>Últimas Decisões / Jogadas</strong></div>
          <div id="decisions-list">Carregando...</div>
        </div>
      </section>

      <section id="panel-logs" class="panel">
        <div class="card full">
          <div class="card-header"><strong>Logs em Tempo Real</strong></div>
          <div id="log-box" class="log-box">Aguardando eventos...</div>
        </div>
      </section>

      <section id="panel-settings" class="panel">
        <div class="card full">
          <div class="card-header"><strong>Configurações & Info</strong></div>
          <div class="form-col">
            <div>API base: <code id="api-base-2">/</code></div>
            <div>Spin interval (s): <span id="spin-interval">-</span></div>
            <div>
              Supabase: <input id="cfg-supabase-url" placeholder="SUPABASE_URL" />
              <button class="btn" onclick="testFrontendConfig()">Testar /api/config/frontend</button>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
